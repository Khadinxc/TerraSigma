// Title: Windows Suspicious Child Process from Node.js - React2Shell
// Author: Swachchhanda Shrawan Poudel (Nextron Systems), Nasreddine Bencherchali
// Date: 2025-12-05
// Level: high
// Description: Detects suspicious child processes started by Node.js server processes on Windows, which may indicate exploitation of vulnerabilities like CVE-2025-55182 (React2Shell).
// Attackers can abuse the Node.js 'child_process' module to run system commands or scripts using methods such as spawn(), exec(), execFile(), fork(), or execSync().
// If execSync() or exec() is used in the exploit, the command line often shows a shell (e.g., cmd.exe /d /s /c ...) running a suspicious command unless other shells are explicitly invoked.
// For other methods, the spawned process appears directly in the Image field unless a shell is explicitly used.
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1059, attack.initial-access, attack.t1190, detection.emerging-threats, cve.2025-55182

DeviceProcessEvents
| where ((InitiatingProcessCommandLine contains "--experimental-https" or InitiatingProcessCommandLine contains "--experimental-next-config-strip-types" or InitiatingProcessCommandLine contains "\\node_modules\\next" or InitiatingProcessCommandLine contains "next dev" or InitiatingProcessCommandLine contains "next start" or InitiatingProcessCommandLine contains "next\" start" or InitiatingProcessCommandLine contains "node_modules\\.bin\\\\..\\next" or InitiatingProcessCommandLine contains "react-scripts start" or InitiatingProcessCommandLine contains "start-server.js") and InitiatingProcessFolderPath endswith "\\node.exe") and (((ProcessCommandLine contains "\\net" or ProcessCommandLine contains "bitsadmin" or ProcessCommandLine contains "certutil " or ProcessCommandLine contains "conhost --headless" or ProcessCommandLine contains "cscript " or ProcessCommandLine contains "curl" or ProcessCommandLine contains "ipconfig" or ProcessCommandLine contains "java" or ProcessCommandLine contains "lua" or ProcessCommandLine contains "mshta" or ProcessCommandLine contains "netsh" or ProcessCommandLine contains "nslookup " or ProcessCommandLine contains "perl" or ProcessCommandLine contains "ping " or ProcessCommandLine contains "powershell" or ProcessCommandLine contains "pwsh" or ProcessCommandLine contains "python" or ProcessCommandLine contains "reg " or ProcessCommandLine contains "reg.exe" or ProcessCommandLine contains "regsvr32" or ProcessCommandLine contains "ruby" or ProcessCommandLine contains "rundll32" or ProcessCommandLine contains "sc.exe" or ProcessCommandLine contains "systeminfo" or ProcessCommandLine contains "wget" or ProcessCommandLine contains "whoami" or ProcessCommandLine contains "wmic" or ProcessCommandLine contains "wscript") or ((FolderPath endswith "\\bash.exe" or FolderPath endswith "\\bitsadmin.exe" or FolderPath endswith "\\certutil.exe" or FolderPath endswith "\\cscript.exe" or FolderPath endswith "\\curl.exe" or FolderPath endswith "\\ipconfig.exe" or FolderPath endswith "\\mshta.exe" or FolderPath endswith "\\net.exe" or FolderPath endswith "\\net1.exe" or FolderPath endswith "\\netsh.exe" or FolderPath endswith "\\nslookup.exe" or FolderPath endswith "\\OpenConsole.exe" or FolderPath endswith "\\perl.exe" or FolderPath endswith "\\ping.exe" or FolderPath endswith "\\powershell.exe" or FolderPath endswith "\\pwsh.exe" or FolderPath endswith "\\py.exe" or FolderPath endswith "\\python.exe" or FolderPath endswith "\\pythonw.exe" or FolderPath endswith "\\pyw.exe" or FolderPath endswith "\\reg.exe" or FolderPath endswith "\\regsvr32.exe" or FolderPath endswith "\\rundll32.exe" or FolderPath endswith "\\sc.exe" or FolderPath endswith "\\sh.exe" or FolderPath endswith "\\systeminfo.exe" or FolderPath endswith "\\wget.exe" or FolderPath endswith "\\whoami.exe" or FolderPath endswith "\\wmic.exe" or FolderPath endswith "\\wscript.exe" or FolderPath endswith "\\wt.exe") or FolderPath contains "\\python")) or (FolderPath endswith "\\cmd.exe" and (not(ProcessCommandLine contains "/d /s /c "))) or ((ProcessCommandLine contains "/d /s /c " and FolderPath endswith "\\cmd.exe") and (not((ProcessCommandLine contains "git config --local --get remote.origin.url" or (ProcessCommandLine contains "\\mkcert\\" and ProcessCommandLine contains " -CAROOT") or (ProcessCommandLine contains "\\mkcert\\" and ProcessCommandLine contains " -install ") or (ProcessCommandLine contains "netstat -ano | findstr /C:" and ProcessCommandLine contains " | findstr LISTENING"))))))